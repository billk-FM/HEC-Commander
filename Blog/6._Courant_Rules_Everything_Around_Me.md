# Courant Rules Everything Around Me 
## Balancing Accuracy, Resolution, and Efficiency in Large-Scale HEC-RAS Modeling 

<p align="center">
  <img src="img/CourantRulesEverythingAroundMe.png" width="500">
</p>
 
## I. Introduction

In HEC-RAS modeling, we often find ourselves grappling with complex challenges that demand innovative solutions. Just as the Wu-Tang Clan once declared that "Cash Rules Everything Around Me" in their iconic song "C.R.E.A.M.," we modelers might say that "Courant Rules Everything Around Me." The Courant number, a key factor in model stability and performance, is a critical consideration in our quest to build accurate, efficient, and scalable models.

As we tackle increasingly large-scale modeling projects, we find ourselves at a crossroads. How do we balance the need for high-resolution, accurate results with the practical constraints of computational resources and project timelines? In this blog post, we'll explore this central challenge and discuss strategies for finding the optimal balance between accuracy, resolution, and efficiency in large-scale hydraulic modeling.

## II. HEC-RAS Guidance on Grid Size and Time Step Selection

The developers of HEC-RAS have provided valuable guidance on selecting appropriate grid sizes and time steps for 2D modeling. They emphasize the importance of creating a computational mesh that accurately represents the terrain, flow paths, and hydraulic controls. HEC-RAS employs a unique approach, using detailed elevation-volume/area relationships for cells and cross-sections for faces, which allows for larger cell sizes while still capturing the essential features of the terrain.

When developing a computational mesh in HEC-RAS, modelers should focus on aligning cell faces with barriers to flow, such as levees, roads, and natural high ground. Refinement regions along channel banks can help ensure proper separation of main channel and overbank flows. Additionally, cell sizes should be selected to adequately capture changes in water surface slope and velocity.

Once a suitable mesh is created, modelers must select an appropriate computational time step based on the cell size and flow velocity. HEC-RAS provides guidelines for choosing time steps based on the equation set being used (Shallow Water or Diffusion Wave) and the desired Courant number. The Courant number is a dimensionless value that relates the computational time step, cell size, and flow velocity:
```
C = VΔT / ΔX ≤ 1.0 (with a max C = 3.0 for Shallow Water Equations and max C = 5.0 for Diffusion Wave Equations)
```

Where:
- C = Courant Number
- V = Flood wave velocity (ft/s)
- ΔT = Computational time step (s)
- ΔX = Average cell size (ft)

Importantly, modelers are advised to test the consistency of their mesh and time step by running simulations with varying resolutions and time steps to assess the impact on results and performance. This process of testing and refinement is crucial for finding the sweet spot between accuracy and efficiency, particularly in large-scale modeling projects.

## III. Challenges of Applying Guidance to Large-Scale Models

While HEC-RAS's guidance on mesh design and time step selection is invaluable, strictly adhering to these principles can lead to significant challenges when working with large-scale models. As the size and complexity of the model domain increase, the computational demands can quickly become overwhelming, resulting in impractical runtimes that hinder the model development and application process.

At the heart of this challenge lies the fundamental tradeoff between resolution, accuracy, and computational efficiency. Pursuing a highly detailed mesh with small cell sizes throughout the model domain may improve accuracy but often comes at the cost of extremely long runtimes. This is particularly problematic during the model development lifecycle, where frequent runs are necessary for calibration, debugging, and scenario testing.

Moreover, current modeling packages often lack advanced features like GPU acceleration that could help mitigate these performance issues. As a result, modelers are forced to make difficult decisions about how to allocate limited computational resources while striving to maintain acceptable levels of accuracy and resolution.

## IV. Proposed Approach: Tiered Resolution and Minimum Cell Size

To address the challenges of large-scale hydraulic modeling, we propose a tiered resolution approach that balances the need for accuracy and efficiency. This strategy involves enforcing a minimum cell size throughout the model domain to manage computational demands while strategically applying finer meshes in critical areas such as channels, key hydraulic controls, and regions of complex flow patterns.

By maintaining a coarser overall resolution, modelers can significantly reduce the total number of cells in the model, leading to faster runtimes and improved stability. However, it's essential to recognize that this approach may require accepting some approximations in smaller features that cannot be fully resolved at the chosen cell size. In these cases, techniques like terrain modification or increased roughness values can be used to parameterize the effects of these features on the overall flow dynamics.

The tiered resolution approach allows modelers to allocate computational resources where they are needed most, ensuring that the key drivers of flow behavior are accurately represented while maintaining acceptable performance. This strategy requires careful consideration of the model's objectives, the spatial distribution of critical hydraulic features, and the available computational resources.

## V. Pitfalls of Over-Reliance on Adaptive Timesteps

Adaptive timesteps can be a valuable tool for improving model stability and performance, particularly in situations where flow conditions vary significantly across the model domain. By automatically adjusting the time step based on local Courant number calculations, adaptive timesteps can help maintain numerical stability while minimizing computational demands.

However, it's crucial to recognize that adaptive timesteps are not a panacea for fundamental issues with model design and mesh resolution. Over-reliance on adaptive timesteps can sometimes lead to increased model instability and usability issues, particularly if the underlying mesh is not well-suited to the flow conditions being simulated.

In some cases, modelers may find that adaptive timesteps are necessary to handle specific terrain features or flow conditions that cannot be adequately represented at the chosen cell size. However, it's generally preferable to address these issues through strategic mesh refinement or terrain modification rather than relying solely on adaptive timesteps to compensate for mesh limitations.

## VI. Balancing Tradeoffs in Large-Scale Modeling

Ultimately, successful large-scale hydraulic modeling requires a delicate balance between accuracy, resolution, and computational efficiency. Modelers must work within the constraints of their available software and hardware while striving to allocate limited computational resources in a way that maximizes the value and reliability of their simulations.

This balance will look different for every project, depending on the specific objectives, data availability, and computational constraints. Modelers must think critically about these tradeoffs and make informed decisions based on a deep understanding of the problem at hand and the strengths and limitations of their modeling tools.

By embracing innovative approaches like tiered resolution meshes, strategic terrain modification, and judicious use of adaptive timesteps, modelers can navigate these tradeoffs more effectively. However, it's important to recognize that there is no one-size-fits-all solution, and the optimal approach will vary depending on the unique characteristics of each modeling project.

## V. Conclusion

In conclusion, balancing accuracy, resolution, and efficiency in large-scale hydraulic modeling is a complex and ongoing challenge that requires careful consideration of multiple factors. By adopting innovative strategies like tiered resolution approach with minimum mesh spacing, strategic terrain modification, and avoiding the use of adaptive timesteps as a way of avoiding mesh edits, modelers can navigate these tradeoffs more effectively and deliver reliable, accurate simulations even in the face of computational constraints. 

## Sdditional References
1. [Selecting an Appropriate Grid Size and Time Step](https://www.hec.usace.army.mil/confluence/rasdocs/r2dum/latest/developing-a-terrain-model-and-computational-mesh/selecting-an-appropriate-grid-size-and-time-step)

2. [Compound Flood Transition Zone Pilot Study for the Amite River Basin](https://thewaterinstitute.org/assets/docs/reports/Compound-Flood-Transition-Zone-Pilot-Study-for-the-Amite-River-Basin.pdf)
   
3. [An Adaptive Time-Step Optimization Method for 2D HEC-RAS Simulations](https://www.kleinschmidtgroup.com/ras-post/an-adaptive-time-step-optimization-method-for-2d-hec-ras-simulations/)
